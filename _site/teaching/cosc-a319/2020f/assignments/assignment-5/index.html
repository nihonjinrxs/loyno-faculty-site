<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      TCP Packet Parser &middot; Ryan Bensussan Harvey
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-KwxQKNj2D0XKEW5O/Y6haRH39PE/xry8SAoLbpbCMraqlX7kUP6KHOnrlrtvuJLR" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="/loyno-faculty-site/public/css/poole.css">
  <link rel="stylesheet" href="/loyno-faculty-site/public/css/syntax.css">
  <link rel="stylesheet" href="/loyno-faculty-site/public/css/lanyon.css">
  <link rel="stylesheet" href="/loyno-faculty-site/public/css/custom.css">

  <!-- favicon -->
  <link rel="apple-touch-icon" sizes="57x57" href="https://www.loyno.edu/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://www.loyno.edu/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://www.loyno.edu/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://www.loyno.edu/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://www.loyno.edu/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://www.loyno.edu/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://www.loyno.edu/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://www.loyno.edu/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://www.loyno.edu/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="https://www.loyno.edu/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.loyno.edu/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="https://www.loyno.edu/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.loyno.edu/favicon-16x16.png">
  <!-- link rel="manifest" href="./manifest.json" -->
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="https://www.loyno.edu/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-ryan sidebar-overlay">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" >

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Information about Ryan's teaching, research and computer science education work.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/loyno-faculty-site/">Home</a>

     
    
     
     
       
         
       
     
       
     
       
     
       
        
          <a  class="sidebar-nav-item" 
              href="/loyno-faculty-site/blog/">
            Blog
          </a>
         
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
    

    <p class="sidebar-nav-item sidebar-nav-heading">Teaching</p>
     
     
       
     
       
     
       
     
       
     
       
     
       
     
       
        
          <a  class="sidebar-nav-item level-2" 
              href="/loyno-faculty-site/teaching/cosc-a319/">
            <i class="fa fa-angle-right"></i>
            <p>COSC A319 Internet Technologies</p>
          </a>
         
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
     
       
        
          <a  class="sidebar-nav-item level-2" 
              href="/loyno-faculty-site/teaching/cosc-a451/">
            <i class="fa fa-angle-right"></i>
            <p>COSC A451 Software Engineering</p>
          </a>
         
       
     
       
     
       
     
       
     
       
     
       
     
       
    

    <div class="sidebar-nav-item sidebar-nav-heading">
      <a href="">
        <small>
          <i class="fa fa-code-fork"></i> Fork this site on GitHub
        </small>
      </a>
    </div>
    <span class="sidebar-nav-item">
      <small>
        Site v1.3.0, updated 11/16/2020
      </small>
    </span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2020 Ryan B. Harvey. All rights reserved.
    </p>
    <small>
      <p>
        The contents of this communication are the sole responsibility of Ryan B. Harvey and do not necessarily represent the opinions or policies of Loyola University New Orleans.
      </p>
    </small>
  </div>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/loyno-faculty-site/" title="Home">Ryan Bensussan Harvey</a>
            <small>Instructor in Computer Science <div class='social-icons'><a href='https://github.com/nihonjinrxs' target='_blank' alt='GitHub account'><i class='fa fa-github'> </i></a> <a href='https://twitter.com/CodeAndData' target='_blank' alt='Twitter account'><i class='fa fa-twitter'> </i></a> <a href='https://www.linkedin.com/in/ryanbharvey' target='_blank' alt='LinkedIn account'><i class='fa fa-linkedin-square'> </i></a> <a href='http://datascientist.guru' target='_blank' alt='Professional website of Ryan B. Harvey'><i class='fa fa-globe'> </i></a></div></small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="page">
  <a name="title" class='md-header-anchor'></a>
  <h1 class="page-title">
    
    
    <span class="page-subtitle">COSC A319 Internet Technologies (Fall 2020) - Assignment A5</span><br />
    
    
    TCP Packet Parser
    
  </h1>
  <ul>
  <li><a href="#summary">Summary</a></li>
  <li><a href="#-schedule">üìÜ Schedule</a></li>
  <li><a href="#background">Background</a>
    <ul>
      <li><a href="#transmission-control-protocol-tcp">Transmission Control Protocol (TCP)</a></li>
      <li><a href="#ports-and-sockets">Ports and Sockets</a></li>
      <li><a href="#tcp-packet-structure">TCP Packet Structure</a></li>
      <li><a href="#tcp-transactions-and-related-header-fields">TCP Transactions and Related Header Fields</a></li>
      <li><a href="#the-tcp-options-field">The TCP Options Field</a>
        <ul>
          <li><a href="#the-checksum-field-and-ip-pseudo-headers">The Checksum Field and IP Pseudo-headers</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#your-assignment">Your Assignment</a>
    <ul>
      <li><a href="#expected-output">Expected Output</a></li>
      <li><a href="#bonus-challenge-integration">Bonus Challenge: Integration</a></li>
      <li><a href="#program-structure">Program Structure</a>
        <ul>
          <li><a href="#a-note-on-working-with-binary-in-javascript">A note on working with binary in JavaScript</a></li>
          <li><a href="#bitwise-operations-to-get-to-individual-bit-values-in-javascript">Bitwise operations to get to individual bit values in JavaScript</a></li>
          <li><a href="#getting-started-on-the-assignment">Getting started on the assignment</a></li>
        </ul>
      </li>
      <li><a href="#submission-and-feedback">Submission and Feedback</a></li>
    </ul>
  </li>
</ul>

<h2 id="summary">Summary</h2>

<p>In this assignment, you‚Äôll create and export a function that parses
a Transmission Control Protocol (TCP) packet.</p>

<h2 id="-schedule">üìÜ Schedule</h2>

<table>
  <tbody>
    <tr>
      <td>Assigned</td>
      <td>Tue, Nov 3, 2020</td>
    </tr>
    <tr>
      <td>Office hours</td>
      <td><a href="https://bit.ly/mr-harvey-office-hours">By appointment</a></td>
    </tr>
    <tr>
      <td>Assignment Due</td>
      <td>Thu, Nov 12, 2020</td>
    </tr>
  </tbody>
</table>

<h2 id="background">Background</h2>

<h3 id="transmission-control-protocol-tcp">Transmission Control Protocol (TCP)</h3>

<p>TCP is a Transport layer protocol, operating on layer 4 of the layered
network model, and is often found encapsulated as the payload of Internet
Protocol version 4 (IPv4) or Internet Protocol version 6 (IPv6) packets.
TCP is currently used for a large portion of the World-Wide Web data sent
over the Internet today.</p>

<p>TCP is a more complex protocol than its sibling protocol UDP. The
<em>connection-oriented</em> nature of the TCP protocol adds a number of
complexities to the communication interaction than might be expected,
and in fact, TCP adds some functionality that would normally fall under
the responsibilities of Session layer services (layer 5 in the 7-layer
model, and part of layer 5 Application layer in the Internet 5-layer model).
These additions include ‚Äústate variables‚Äù (information on the history
of the connection while it‚Äôs active), quality of service information,
flow and congestion control mechanisms, and message segmentation.</p>

<h3 id="ports-and-sockets">Ports and Sockets</h3>

<p>As we saw in looking at UDP, addresses on the Transport layer are
called ports. Ports are 16-bit (2-byte) unsigned integer values
(between 0 and 65535), and address processes on a host. (Recall that
host-level addressing is handled at the Network layer using the Internet
Protocol‚Äôs addressing schemes ‚Äì versions 4 and 6.)</p>

<p>Although ports are represented as simple unsigned integer
values, all ports are not the same. Port numbers are managed
by the Internet Assigned Numbers Authority (IANA) in the
<a href="https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml"><em>Service Name and Transport Protocol Port Numbers Registry</em></a>.
There are three classes of ports:</p>

<ul>
  <li>Well-known ports (0 - 1023): assigned and controlled</li>
  <li>Registered ports (1024 - 49151): not assigned or controlled,
but can be <a href="https://www.iana.org/form/ports-services">registered with IANA</a>
by organizations/entities to prevent duplication</li>
  <li>Dynamic ports (49152 - 65535): used as temporary or
private ports; not assigned, controlled or registered</li>
</ul>

<p>You will often make use of several of the well-known ports:</p>

<ul>
  <li>20 &amp; 21 - file transfer protocol (FTP), data &amp; control</li>
  <li>22 - secure shell (SSH) remote server access</li>
  <li>25 - SMTP email transport</li>
  <li>53 - domain name service (DNS)</li>
  <li>67 &amp; 68 - DHCP server &amp; client, likely used by your computer to
find an available IP address to use on your local network</li>
  <li>80 - HTTP, used for web pages and web-based communications</li>
  <li>110 - POP3, email access</li>
  <li>115 - SFTP, secure FTP using Secure Sockets Layer (SSL) encryption</li>
  <li>143 - IMAP email access</li>
  <li>443 - HTTPS, secure HTTP using Secure Sockets Layer (SSL) encryption</li>
</ul>

<p>In addition, if you use a database, you may also run into
vendor registered ports, for example:</p>

<ul>
  <li>1433 - default connection port for MS SQL Server processes</li>
  <li>3306 - default connection port for MySQL server processes</li>
  <li>5432 - default connection port for PostgreSQL server processes</li>
  <li>6379 - default connection port for Redis server processes</li>
  <li>27017 - default connection port for MongoDB server processes</li>
</ul>

<p>When combined with an IP address to address a specific process
on a specific host, the combination of port and IP address is
called a socket. A socket is an abstract concept representing
the address of a process on a host, and many programming language
standard libraries have socket abstractions that you can use
when building software.</p>

<h3 id="tcp-packet-structure">TCP Packet Structure</h3>

<p>The packet structure of a TCP packet involves a variable-length
header containing several fields, which can be between 20 and 60
bytes. There are a number of important fields to consider here:</p>

<ul>
  <li>source port (16-bit unsigned integer)</li>
  <li>destination port (16-bit unsigned integer)</li>
  <li>initial sequence number (32-bit unsigned integer)</li>
  <li>acknowledgement number (32-bit unsigned integer)</li>
  <li>header length (4-bit unsigned integer, specified in 4-byte units
(so, value is between 5 and 15); packed with 4 bit of reserved
space to make a single byte)</li>
  <li>control flags (1-bit each, packed into a single byte; see below for details)</li>
  <li>window size (16-bit unsigned integer)</li>
  <li>checksum (16-bit unsigned integer; see below for details)</li>
  <li>urgent pointer (16-bit unsigned integer)</li>
  <li>options field (between 0 and 40 bytes, padded to 4-byte boundaries)</li>
</ul>

<p>The payload data if included, follows the header. Its size is controlled by the
transaction-determined window size (in the window size header field).</p>

<pre><code class="language-{text}">TCP Packet Structure
|------------------------header---------------. . .-----|----------payload-. . .----|
0       4       8      12      16      20             20-60                         |
----------------------------------------------. . .-----------------------. . .------
| ' ' ' | ' ' ' | ' ' ' | ' ' ' | ' ' ' | ' ' . . . ' ' | ' ' ' ' ' ' ' ' . . . ' ' |
| 2B| 2B|4 bytes|4 bytes| | | 2B| 2B| 2B|    Options    |       Payload Data        |
|Src|Dst|  Seq  |  Ack  |H|F|Win|Chk|Urg| 0 to 40 bytes |    size controlled by     |
|Prt|Prt|  Num  |  Num  |L| |Siz|Sum|Ptr|in 4B multiples|      by window size       |
----------------------------------------------. . .------------------------. . .-----
</code></pre>

<h3 id="tcp-transactions-and-related-header-fields">TCP Transactions and Related Header Fields</h3>

<p>TCP-based communication is carried out through ‚Äútransactions‚Äù, however
these transactions are not the same as what you may understand in other
areas like a banking transaction or a database transaction. TCP
transactions don‚Äôt involve the simultaneous coordination of multiple
resources across a communication channel ‚Äì instead, they are a way of
packing several request-response pairs into one connection setup and
teardown. Thus, these transactions involve three phases: setup, data
transfer, and release. These are managed through messages employing the
control flags to identify the purpose of the message.</p>

<p>The control flags one bit each, packed into byte 13 of the header (labelled
<code class="language-plaintext highlighter-rouge">F</code> in the diagram), and are the following:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ECN-CWR</code> - Explicit Congestion Notification, Congestion Window Reduced (acknowledge signal from receiver)</li>
  <li><code class="language-plaintext highlighter-rouge">ECN-Echo</code> - Explicit Congestion Notification, Echo (signal sender to reduce)</li>
  <li><code class="language-plaintext highlighter-rouge">URG</code> - Urgent (flags that the Urgent Pointer field is valid, indicating raised priority of the segment)</li>
  <li><code class="language-plaintext highlighter-rouge">ACK</code> - Acknowledgement (flags that the Acknowledgement Number field is valid)</li>
  <li><code class="language-plaintext highlighter-rouge">PSH</code> - Push (flags that the segment data should not be buffered, but rather sent directly to the application in real-time)</li>
  <li><code class="language-plaintext highlighter-rouge">RST</code> - Reset (flags that the connection should be aborted; governed by rules due to TCP connection hijacking)</li>
  <li><code class="language-plaintext highlighter-rouge">SYN</code> - Synchronize (flags that the hosts should synchronize sequence numbers and establish a connection)</li>
  <li><code class="language-plaintext highlighter-rouge">FIN</code> - Finish (flags that the sender has finished sending data and initiated a close of the connection)</li>
</ul>

<p>Connections are setup through a <em>three-way handshake</em>:</p>

<ol>
  <li>Client <code class="language-plaintext highlighter-rouge">----SYN---&gt;</code> Server</li>
  <li>Client <code class="language-plaintext highlighter-rouge">&lt;-SYN,ACK--</code> Server</li>
  <li>Client <code class="language-plaintext highlighter-rouge">----ACK---&gt;</code> Server</li>
</ol>

<p>Following the connection handshake, data transfer begins in the
form of request-response pairs between the Client and Server system.
Once the data has been completely transferred over possibly many
request-response pairs, upon an empty response from the server
acknowledging the full amount of data, the connection is closed
via a <em>connection release</em> exchange:</p>

<ol>
  <li>Client <code class="language-plaintext highlighter-rouge">&lt;-FIN--</code> Server</li>
  <li>Client <code class="language-plaintext highlighter-rouge">--ACK-&gt;</code> Server</li>
  <li>Client <code class="language-plaintext highlighter-rouge">--FIN-&gt;</code> Server</li>
  <li>Client <code class="language-plaintext highlighter-rouge">&lt;-ACK--</code> Server</li>
</ol>

<p>As part of a connection setup, the initial sequence numbers, receive
buffer space available locally for data, and possibly the maximum
segment size (MSS) of each party are shared. MSS is usually the data link
MTU minus IP and TCP header sizes, but is sometimes set at 512 or 536 bytes.
(MTU is the maximum transmission unit, which we‚Äôll learn more about when
we discuss the Internet Protocol, or IP.)</p>

<p>Every byte of data transferred in a TCP transaction is acknowledged (as
well as every non-data request or response) by increment of the sequence
number header field. In this way, the sender can understand what data the
recipient has received so far, and can resend data that has not been
acknowledged if needed. This also allows for some flow control. Data
transfer uses the window size to govern how much data can be sent
unacknowledged. This is often referred to as <em>sliding window flow control</em>,
whereby the window size specified marks the maximum number of bytes that
the sender can send without acknowledgement by the recipient of prior data
sent. When a new acknowledgement is received by the sender, if there is no
gap in the acknowledgement number, the available window for sending data
is increased by the number of bytes acknowledged. Further flow control
is accomplished through the <code class="language-plaintext highlighter-rouge">ECN</code> (explicit congestion control) flag bits
in the packet header, which when set, indicate that the window size should
temporarily be set to zero, preventing further sends until the congestion
is cleared.</p>

<h3 id="the-tcp-options-field">The TCP Options Field</h3>

<p>Options extend the TCP header, and are used to provide additional information
about the segment and how to handle it. Options have a multi-byte structure
as follows:</p>

<pre><code class="language-{text}">TCP Option
|-------. . .----
0 1 2           |
--------. . .----
| ' ' '       ' |
| | |   Option  |
|T|L|    Data   |
| | |(L-2) bytes|
--------. . .----
</code></pre>

<p>There are several option types (<code class="language-plaintext highlighter-rouge">T</code>) with varying lengths <code class="language-plaintext highlighter-rouge">L</code>. Note that the
option length (<code class="language-plaintext highlighter-rouge">L</code>) field specifies the length including the initial two bytes,
so option data length is always <code class="language-plaintext highlighter-rouge">L - 2</code> bytes. Various option types and their
meanings, with references, can be found in
<a href="https://www.iana.org/assignments/tcp-parameters/tcp-parameters.xhtml">IANA‚Äôs TCP Option Kind Numbers list</a>.</p>

<p>When parsing options for this assignment, you‚Äôll need to provide both the numeric option type <code class="language-plaintext highlighter-rouge">T</code> as the field <code class="language-plaintext highlighter-rouge">type_id</code>, as well as a string with the option type name. For the option type name field <code class="language-plaintext highlighter-rouge">type</code>, you will use the option name as listed in the <em>Meaning</em> column of Table 12.2 of your text <em>The Illustrated Network</em>. Parsed options should also present their byte length <code class="language-plaintext highlighter-rouge">L</code> as the <code class="language-plaintext highlighter-rouge">length</code> field and any relevant fields (using their abbreviated names) as defined by the RFC listed in Table 12.2 that defines the option. RFCs can be found at <a href="http://rfc-editor.net">rfc-editor.net</a>.</p>

<h4 id="the-checksum-field-and-ip-pseudo-headers">The Checksum Field and IP Pseudo-headers</h4>

<p>Similar to UDP, the checksum of the TCP header makes use of the
IP pesudo-header. A product of the long period during development
of the internet when the Network and Transport layer protocols were
not distinct, the checksum of a TCP packet is calculated on an
augmented version of the packet that includes a <em>pseudo-header</em> of
data from the encapsulating IP packet. Because the fields in the
IPv4 and IPv6 packet headers differ significantly, so also does the
TCP IPv4 pseudo-header from the TCP IPv6 pseudo-header. Both
pseudo-headers include the host addresses for source and destination,
as well as the protocol ID for the encapsulated packet (TCP for IPv4,
but could be different for IPv6), and the TCP length value from the
IP packet header. Both pseudo-headers also employ a filler of all
zeros to align data to 4-byte boundaries.</p>

<p>The TCP IPv4 and UDP IPv6 pseudo-header structures are included below.
Byte 9 in the IPv4 pseudo-header, labeled <code class="language-plaintext highlighter-rouge">Pr</code> is the <em>Protocol</em> field
of the IPv4 header. Similarly, byte 39 of the IPv6 pseudo-header,
labeled <code class="language-plaintext highlighter-rouge">N H</code> is the <em>Next Header</em> field of the IPv6 packet header.
These fields are 1 byte each, and take unsigned 8-bit integer values
identifying the protocol of the encapsulated packet. Those <a href="https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml">protocol
numbers</a>
are also managed by IANA. The protocol number for TCP is 6.</p>

<pre><code class="language-{text}">UDP IPv4 Pseudo-header Structure
0           4           8          12
-------------------------------------
|  '  '  '  |  '  '  '  |  '  '  '  |
|  4 bytes  |  4 bytes  |1B|1B| 2B  |
|   Source  |    Dest   |  |Pr| UDP |
|    IPv4   |    IPv4   |0s|  | Len |
-------------------------------------
</code></pre>

<pre><code class="language-{text}">UDP IPv6 Pseudo-header Structure
0       4       8      12      16      20      24      28      32      36      40
---------------------------------------------------------------------------------
| ' ' ' | ' ' ' | ' ' ' | ' ' ' | ' ' ' | ' ' ' | ' ' ' | ' ' ' | ' ' ' | ' ' ' |
|           16 bytes            |           16 bytes            |  TCP  |     |N|
|      Source IPv6 Address      |   Destination IPv6 Address    |  Len  |     |H|
|                               |                               |       | 0s  | |
---------------------------------------------------------------------------------
</code></pre>

<p>The relevant pseudo-header is attached at the beginning of the packet,
before the TCP header, and the checksum field of the TCP header is
zero-filled. Using that data, the checksum is then calculated as the
16-bit one‚Äôs compliment of the one‚Äôs compliment sum of the combined
data.</p>

<p>You can use <a href="https://www.npmjs.com/package/raw-socket#rawcreatechecksum-bufferorobject-bufferorobject-">the <code class="language-plaintext highlighter-rouge">createChecksum</code> function of the <code class="language-plaintext highlighter-rouge">raw-socket</code> Node.js
package</a>
to compute the proper checksum for the data.</p>

<h2 id="your-assignment">Your Assignment</h2>

<p>To complete this assignment, you need to write the body of the <code class="language-plaintext highlighter-rouge">parse</code>
function defined and exported from <code class="language-plaintext highlighter-rouge">index.js</code>. You do not need to worry
about asynchronous operations for this ‚Äì just be able to parse the
incoming byte <code class="language-plaintext highlighter-rouge">Buffer</code>(s) using the TCP protocol.</p>

<h3 id="expected-output">Expected Output</h3>

<p>Your function should return a JavaScript object with the fields and
structure specified below. Expected data types and descriptions are
included in parentheses.</p>

<pre><code class="language-{text}">{
  protocol: "TCP",
  header: {
    destination_port: (16-bit unsigned integer value),
    source_port: (16-bit unsigned integer value),
    sequence_number: (32-bit unsigned integer value),
    acknowledgement_number: (32-bit unsigned integer value),
    header_length: (4-bit unsigned integer value),
    header_bytes: (header_length value, converted to units of bytes),
    control_flags: {
      ECN_CWR: (boolean, 0 = false, 1 = true),
      ECN_ECHO: (boolean, 0 = false, 1 = true),
      URG: (boolean, 0 = false, 1 = true),
      ACK: (boolean, 0 = false, 1 = true),
      PSH: (boolean, 0 = false, 1 = true),
      RST: (boolean, 0 = false, 1 = true),
      SYN: (boolean, 0 = false, 1 = true),
      FIN: (boolean, 0 = false, 1 = true)
    },
    window_size: (16-bit unsigned integer value),
    checksum: (16-bit 1's compliment checksum including IP pseudo-header),
    urgent_pointer: (16-bit unsigned integer values),
    options: [
      (an object for each option with relevant fields:
      {
        type_id: (numeric type as unsigned 8-bit integer),
        type: (string, type description per "Meaning" column of Table 12.2 in your textbook),
        length: (byte length of the option as unsigned 8-bit integer if relevant),
        (...other relevant fields, as defined by the RFC defining the option)
      })
    ]
  },
  pseudo_header: {
    pseudo_header_protocol: ("IPv4" or "IPv6"),
    source_ip: (IPv4 or IPv6 address),
    destination_ip: (IPv4 or IPv6 address),
    protocol: (unsigned integer value protocol identifier),
    length: (TCP packet length, unsigned integer value)
  },
  payload: (payload data in binary format as an Buffer with appropriate length),
  checksum_valid: (boolean, true if checksum is valid for data in packet)
}
</code></pre>

<h3 id="bonus-challenge-integration">Bonus Challenge: Integration</h3>

<p>Once this is complete and passing tests, copy this project into a new folder <code class="language-plaintext highlighter-rouge">lib/tcp</code> in
your Assignment A2 project (similar to what you did with the Assignment A1 code in the
<code class="language-plaintext highlighter-rouge">lib/ethernet</code> folder). Then, use this to parse the payload from UDP packets found by your
Assignment 2 async parser, and replace the <code class="language-plaintext highlighter-rouge">payload</code> key‚Äôs current <code class="language-plaintext highlighter-rouge">Buffer</code> value with the
object structure above instead.</p>

<p>Note that you‚Äôll need to construct a couple dummy Ethernet frames that contain TCP
data. The simplest way to do this is just to capture a few packets on your computer. If
that‚Äôs too difficult, you can just generate it by following the frame and packet formats.</p>

<h3 id="program-structure">Program Structure</h3>

<p>While you must make your implementation pass automated tests that
will only use the exported <code class="language-plaintext highlighter-rouge">parse</code> function, you will likely want
to create several additional functions to help with parsing the data.
Each of these functions should be well-tested (repeatably via automation),
so that you can be confident of the accuracy and error-free quality of
your parsing code. Each of these functions should also include relevant
documentation <a href="https://jsdoc.app/">in JSdoc format</a> about why they exist,
including expected inputs and outputs with data types.</p>

<p>In this repo, you will find a <code class="language-plaintext highlighter-rouge">lib</code> folder which contains several things
that should be helpful:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">tcp.js</code> file - this is where you should put the protocol-specific
parsing code you write</li>
</ul>

<h4 id="a-note-on-working-with-binary-in-javascript">A note on working with binary in JavaScript</h4>

<p>In this assignment (as in prior assignments in this course), you‚Äôll be
working with binary data in JavaScript. The interface for this work
will almost always be the <code class="language-plaintext highlighter-rouge">Buffer</code> class and its subclasses. Get to know
the <code class="language-plaintext highlighter-rouge">Buffer</code> class as soon as possible.</p>

<p>In particular, you‚Äôll need to be very familiar with the methods to read
various length unsigned integers, including the little endian (LE) and
big endian (BE) variants and how to choose which variant you need, and the
<code class="language-plaintext highlighter-rouge">subarray</code> method, as well as the typed subclasses of <code class="language-plaintext highlighter-rouge">Buffer</code>.</p>

<h4 id="bitwise-operations-to-get-to-individual-bit-values-in-javascript">Bitwise operations to get to individual bit values in JavaScript</h4>

<p>To work with individual bits, you‚Äôll need to take a byte and bit-shift or
bit-mask it to get the specific bit you‚Äôre looking for. For example, you
to get the third bit from the left in <code class="language-plaintext highlighter-rouge">0x6d = 109 = 0b01101101</code>, you would
could do this by:</p>

<ol>
  <li>Create a bit mask having all zeros except the bit place you wish to
extract, and a one in that bit position. For this example, that would
look like: <code class="language-plaintext highlighter-rouge">0b00100000</code>.</li>
  <li>Then, perform a
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_AND">bitwise <code class="language-plaintext highlighter-rouge">AND</code> operation</a>
between the byte you‚Äôre extracting from and the bit mask you created.
In JavaScript, this example looks like: <code class="language-plaintext highlighter-rouge">0x6d &amp; 0b00100000</code>.</li>
  <li>Finally, bit shift the result to remove the additional bits and get the
flag value. In the example, you will want to
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Right_shift">bit shift to the right</a>
by 5 positions (removing the 5 bit positions to the right of the one you
care about): <code class="language-plaintext highlighter-rouge">(0x6d &amp; 0b00100000) &gt;&gt; 5</code></li>
</ol>

<p>With this process, you can extract the value of a specific bit (a <code class="language-plaintext highlighter-rouge">0</code> or <code class="language-plaintext highlighter-rouge">1</code>),
and can then convert that value to a boolean value by comparing it with <code class="language-plaintext highlighter-rouge">1</code>.
All together, the example would look like this:</p>

<pre><code class="language-{text}">const flagsField = 0x6d; // This would be whatever you read from your packet.
const bit3Value = (flagsField &amp; 0b00100000) &gt;&gt; 5 === 1;
</code></pre>

<p>Note that if you know the base-10 values of these bit mask binary numbers, you
can also use those, simplifying the code a bit:</p>

<pre><code class="language-{text}">const flagsField = 0x6d; // This would be whatever you read from your packet.
const bit3Value = (flagsField &amp; 32) &gt;&gt; 5 === 1;
</code></pre>

<h4 id="getting-started-on-the-assignment">Getting started on the assignment</h4>

<p>As with Assignments A1 and A4, in order to get started with the assignment, you‚Äôll want
to do the following things:</p>

<ul>
  <li>Review this assignment description in detail, particularly the TCP packet structure and
the notes about the various fields, checksum calculation oddities and pseudo-headers</li>
  <li>Explore JavaScript <a href="https://nodejs.org/dist/latest-v12.x/docs/api/buffer.html">Buffer</a></li>
  <li>Explore the bitwise operators in the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators">MDN JavaScript Operators reference</a></li>
  <li>Explore the <code class="language-plaintext highlighter-rouge">raw-socket</code> library‚Äôs <a href="https://www.npmjs.com/package/raw-socket#rawcreatechecksum-bufferorobject-bufferorobject-">createChecksum</a> function</li>
  <li>Clone this repo to your computer</li>
  <li>Read through the comments and code included for you in <code class="language-plaintext highlighter-rouge">index.js</code> and <code class="language-plaintext highlighter-rouge">lib/tcp.js</code></li>
  <li>
    <p>Run the following at the command line from within the project directory (use <code class="language-plaintext highlighter-rouge">cd &lt;path&gt;</code>, replacing
<code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> with the folder path to your project directory, to get there):</p>

    <pre><code class="language-{sh}">nvm install 12.19
nvm use 12.19
npm install
npm test
</code></pre>
  </li>
</ul>

<p>During development, you may wish to run the tests in <em>watch</em> mode, so that each time you save a file,
the tests that file affects will run. To do this, you can use:</p>

<pre><code class="language-{sh}">npm test -- --watch
</code></pre>

<p>This assignment will also automatically check your code style for readability. To run those tests
at your own command line, you can use:</p>

<pre><code class="language-{sh}">npm run lint
</code></pre>

<h3 id="submission-and-feedback">Submission and Feedback</h3>

<p>You must submit your changes as commits to the <code class="language-plaintext highlighter-rouge">main</code> branch on the repository.
Github Classroom will create a pull request on the repository for you, titled
<strong>Feedback</strong>. As you push your commits on the main branch up to Github, they
will be added to the activity on this pull request.</p>

<p>In addition to the synchronous mechanism of requesting help via office hours
appointments, this pull request will be your mechanism for asking questions and
requesting help asynchronously during the course of this assignment. I will also
use this pull request to provide feedback on your work. I will provide feedback on
the completed assignment within a week of the due date of the assignment.
If you push your code earlier than the due date, I will try to provide
feedback as needed earlier.</p>

<p>I suggest that you push your work to Github as you make commits, and that you make
commits frequently as you work on the assignment. This way, if you have questions,
I will be able to review your work-in-progress and give more relevant answers and
feedback. If you have a question specific to a particular area of the code, note that
you can add comments inline on the pull request by clicking on the <strong>Files changed</strong> tab
of the pull request, then clicking the little blue <code class="language-plaintext highlighter-rouge">+</code> icon that appears when you hover
over a specific line of code.</p>

<p>I will do my best to respond to questions posed during the course of the assignment with
in a day of the ask. <strong>If you want to ask a question or request early feedback, please tag
me in a comment on the pull request: <code class="language-plaintext highlighter-rouge">@nihonjinrxs</code>.</strong></p>

<p>Good luck, and I look forward to seeing what you create!</p>

</div>

      </div>
      
<hr>
<div class="container footer">
  Built with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> using
  the <a href="http://lanyon.getpoole.com/" target="_blank">Lanyon theme</a>.
</div>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
 
  ga('create', 'UA-211408-7', 'auto');
  ga('send', 'pageview');
</script>



    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
    <script src="https://use.fontawesome.com/263865d36b.js"></script>
  </body>
</html>
